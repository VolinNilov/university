# R-Curve (Recall Curve)

**R-Curve (Recall Curve)** — это графическое представление зависимости **полноты (Recall)** модели от порога уверенности (**confidence threshold**) или уровня точности (**precision**). Эта кривая используется для анализа способности модели находить все истинные объекты в данных, особенно в задачах детекции объектов.

В библиотеке **Ultralytics**, которая предоставляет реализацию моделей YOLO (You Only Look Once), R-Curve автоматически генерируется после завершения обучения или валидации модели. Она помогает оценить, насколько хорошо модель обнаруживает объекты при различных условиях.



## Что такое Recall?

Прежде чем разбирать R-Curve, важно понять, что такое **Recall (полнота)**.

### Определение:
Recall — это доля правильно предсказанных объектов среди всех истинных объектов. Формула:

**Recall = TP / (TP + FN)**


Где:
- **TP (True Positives)** — количество правильно предсказанных объектов.
- **FN (False Negatives)** — количество пропущенных объектов.

Recall показывает, насколько хорошо модель находит все истинные объекты.



## Что такое R-Curve?

**R-Curve** — это график, который показывает, как меняется значение **Recall** в зависимости от порога уверенности (**confidence threshold**) или уровня точности (**precision**).

### Как строится R-Curve?
1. Модель делает предсказания для тестового набора данных.
2. Для каждого возможного порога уверенности (например, от 0 до 1 с шагом 0.01):
   - Вычисляются TP и FN.
   - Рассчитывается Recall.
3. По оси X откладывается:
   - Либо порог уверенности (**confidence threshold**).
   - Либо уровень точности (**precision**).
4. По оси Y откладывается соответствующее значение Recall.



## Зачем использовать R-Curve?

1. **Оценка способности модели находить объекты**:
   R-Curve помогает оценить, насколько хорошо модель находит истинные объекты при различных порогах уверенности. Например:
   - При низком пороге уверенности модель может находить большинство объектов (высокий Recall), но с большим количеством ложных срабатываний.
   - При высоком пороге уверенности Recall может снижаться, так как модель начинает пропускать истинные объекты.

2. **Анализ поведения модели**:
   Кривая показывает, как изменяется полнота модели при разных порогах уверенности. Это особенно важно для задач, где важно найти все объекты, даже если это приводит к некоторым ошибкам.

3. **Сравнение моделей**:
   R-Curve позволяет сравнить производительность разных моделей, особенно если они обучены на разных датасетах или имеют разные гиперпараметры.



## Как Ultralytics использует R-Curve?

В библиотеке **Ultralytics** R-Curve автоматически генерируется после завершения обучения или валидации модели. Она доступна как часть отчета о производительности модели и может быть визуализирована в виде графика.

### Пример использования:
После запуска обучения модели YOLOv8 с помощью скрипта `train.py`, Ultralytics выводит R-Curve в папке результатов. Это помогает понять:
- Как модель реагирует на изменения порога уверенности.
- Какой порог уверенности является оптимальным для достижения высокого Recall.
- Есть ли проблемы с пропусками объектов.



## Как интерпретировать R-Curve?

1. **Форма кривой**:
   - Обычно R-Curve возрастает с увеличением порога уверенности. Это связано с тем, что более низкий порог уверенности позволяет модели находить больше объектов.
   - Однако слишком низкий порог уверенности может привести к увеличению ложных срабатываний.

2. **Максимум Recall**:
   - Точка, где Recall достигает максимума, показывает, при каком пороге уверенности модель находит наибольшее количество истинных объектов.
   - Этот порог уверенности можно использовать для настройки модели.

3. **Низкие значения Recall**:
   - Если Recall низкий при любых порогах уверенности, это может указывать на проблемы с качеством модели или дисбалансом классов.


## Как использовать R-Curve для улучшения модели?

1. **Настройка порога уверенности**:
   - Используйте порог уверенности, соответствующий максимальному значению Recall, для инференса модели.

2. **Анализ проблемных областей**:
   - Если Recall низкий при высоких порогах уверенности, это может указывать на пропуски истинных объектов.
   - Если Recall не достигает высоких значений даже при низких порогах уверенности, это может указывать на недостаточную способность модели различать объекты.

3. **Оптимизация модели**:
   - Если R-Curve не достигает высоких значений, рассмотрите возможность улучшения модели (например, добавление данных, настройка гиперпараметров).



## Заключение

**R-Curve** — это мощный инструмент для анализа производительности модели в библиотеке Ultralytics. Она помогает:
- Найти оптимальный порог уверенности для достижения высокой полноты.
- Выявить проблемные области (например, пропуски объектов).
- Сравнить производительность разных моделей.

Используйте R-Curve для более глубокого понимания работы вашей модели и принятия решений о дальнейшей оптимизации.