# F1-Curve

**F1-Curve** — это графическое представление зависимости метрики **F1-Score** от порога уверенности (**confidence threshold**) модели. Эта кривая используется для анализа производительности модели детекции объектов, особенно в задачах, где важно найти баланс между точностью (**Precision**) и полнотой (**Recall**).

В библиотеке **Ultralytics**, которая предоставляет реализацию моделей YOLO (You Only Look Once), F1-Curve автоматически генерируется после завершения обучения или валидации модели. Она помогает оценить, насколько хорошо модель работает при различных уровнях уверенности.



## Что такое F1-Score?

Прежде чем разбирать F1-Curve, важно понять, что такое **F1-Score**.

### Определение:
F1-Score — это гармоническое среднее между **Precision** (точностью) и **Recall** (полнотой). Она измеряет баланс между этими двумя метриками:

\[
F1 = 2 \cdot \frac{\text{Precision} \cdot \text{Recall}}{\text{Precision} + \text{Recall}}
\]

- **Precision (точность)**: Доля правильно предсказанных объектов среди всех предсказанных объектов.
  \[
  \text{Precision} = \frac{\text{TP}}{\text{TP} + \text{FP}}
  \]
- **Recall (полнота)**: Доля правильно предсказанных объектов среди всех истинных объектов.
  \[
  \text{Recall} = \frac{\text{TP}}{\text{TP} + \text{FN}}
  \]

F1-Score достигает максимального значения, когда Precision и Recall сбалансированы.



## Что такое F1-Curve?

**F1-Curve** — это график, который показывает, как меняется значение F1-Score в зависимости от порога уверенности (**confidence threshold**). Порог уверенности — это минимальное значение уверенности (confidence score), при котором предсказание модели считается достоверным.

### Как строится F1-Curve?
1. Модель делает предсказания для тестового набора данных.
2. Для каждого возможного порога уверенности (например, от 0 до 1 с шагом 0.01):
   - Вычисляются Precision и Recall.
   - Рассчитывается F1-Score.
3. По оси X откладывается порог уверенности, а по оси Y — соответствующее значение F1-Score.



## Зачем использовать F1-Curve?

1. **Оптимизация порога уверенности**:
   F1-Curve помогает найти оптимальный порог уверенности, при котором F1-Score достигает максимального значения. Это важно для задач, где требуется сбалансированная производительность между Precision и Recall.

2. **Анализ поведения модели**:
   Кривая показывает, как изменяется производительность модели при разных порогах уверенности. Например:
   - При низком пороге уверенности модель может давать много ложных срабатываний (низкая Precision).
   - При высоком пороге уверенности модель может пропускать истинные объекты (низкая Recall).

3. **Сравнение моделей**:
   F1-Curve позволяет сравнить производительность разных моделей, особенно если они обучены на разных датасетах или имеют разные гиперпараметры.



## Как Ultralytics использует F1-Curve?

В библиотеке **Ultralytics** F1-Curve автоматически генерируется после завершения обучения или валидации модели. Она доступна как часть отчета о производительности модели и может быть визуализирована в виде графика.

### Пример использования:
После запуска обучения модели YOLOv8 с помощью скрипта `train.py`, Ultralytics выводит F1-Curve в папке результатов. Это помогает понять:
- Как модель реагирует на изменения порога уверенности.
- Какой порог уверенности является оптимальным для достижения максимального F1-Score.
- Есть ли проблемы с балансом между Precision и Recall.



## Как интерпретировать F1-Curve?

1. **Форма кривой**:
   - Обычно F1-Curve имеет форму колокола: она сначала возрастает, достигает максимума, а затем убывает.
   - Максимальное значение F1-Score указывает на оптимальный порог уверенности.

2. **Максимум F1-Score**:
   - Точка, где F1-Score достигает максимума, показывает лучший баланс между Precision и Recall.
   - Этот порог уверенности можно использовать для настройки модели.

3. **Низкие значения F1-Score**:
   - Если F1-Score низкий при любых порогах уверенности, это может указывать на проблемы с качеством модели или дисбалансом классов.



## Пример визуализации F1-Curve

В Ultralytics F1-Curve обычно представляется в виде графика, где:
- **По оси X**: Порог уверенности (confidence threshold).
- **По оси Y**: Значение F1-Score.
- График имеет форму колокола: F1-Score возрастает до определенного порога уверенности, достигает максимума, а затем убывает.
- Максимальное значение F1-Score достигается при пороге уверенности около 0.4.

Пример графика:
![F1-Curve](https://example.com/f1_curve.png)

*График показывает зависимость F1-Score от Confidence Threshold. Максимальное значение F1-Score достигается при пороге уверенности около 0.4.*

Здесь:
- Пик кривой показывает оптимальный порог уверенности.
- Наклон кривой указывает, как быстро меняется F1-Score при изменении порога.



## Как использовать F1-Curve для улучшения модели?

1. **Настройка порога уверенности**:
   - Используйте порог уверенности, соответствующий максимальному значению F1-Score, для инференса модели.

2. **Анализ проблемных областей**:
   - Если F1-Score низкий при низких порогах уверенности, это может указывать на большое количество ложных срабатываний.
   - Если F1-Score низкий при высоких порогах уверенности, это может указывать на пропуски истинных объектов.

3. **Оптимизация модели**:
   - Если F1-Curve не достигает высоких значений, рассмотрите возможность улучшения модели (например, добавление данных, настройка гиперпараметров).



## Заключение

**F1-Curve** — это мощный инструмент для анализа производительности модели в библиотеке Ultralytics. Она помогает:
- Найти оптимальный порог уверенности для достижения сбалансированной производительности.
- Выявить проблемные области (например, низкую Precision или Recall).
- Сравнить производительность разных моделей.

Используйте F1-Curve для более глубокого понимания работы вашей модели и принятия решений о дальнейшей оптимизации.